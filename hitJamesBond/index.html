<!DOCTYPE html>
<html>
<head>
  <title>Hit James Bond !</title>
</head>
<header>
  <link rel='stylesheet' type='text/css' href='../assets/css/bootstrap.min.css'>
  <link rel='stylesheet' type='text/css' href='../assets/css/font-awesome.min.css'>
</header>
<style type='text/css'>
  @font-face {
    font-family: Skyfall;
    src: url("./fonts/Skyfall.ttf");
  }
  html, body {
    padding: 0;
    margin: 0;
    z-index: 0;
    overflow: hidden;
    cursor: none;
  }

  .end-game, .win-game {
    display: none;
    position: absolute;
    color: white;
    z-index: 15;
    top: 30%;
    text-align: center;
  }

  .end-game {
    left: calc(50% - 250px);
  }

  .win-game {
    left: calc(50% - 200px);
  }

  .end-game h1, .win-game h1 {
    font-family: Skyfall;
  }

  .end-game a, .win-game a {
    margin-top: 20px;
  }

  .content {
    position: absolute;
    z-index: 1;
    left: 0;
    top: 0;
    overflow: hidden;
  }

  .overlay {
    top: 0;
    left: 0;
    z-index: 5;
    position: absolute;
    width: 750px;
    -webkit-box-shadow: 0px 0px 5px 10000px rgb(0,0,0);
    -moz-box-shadow: 0px 0px 5px 10000px rgb(0,0,0);
    box-shadow: 0px 0px 5px 10000px rgb(0,0,0);
    opacity: 0.8;
  }

  .blood {
    position: absolute;
    top: -150%;
    left: 0;
    z-index: 10;
    width: 100%;
    height:150%;
    opacity: 0.8;
    transition: 5s;
  }

  .metal {
    position: absolute;
    top: -100%;
    left: 0;
    z-index: 10;
    width: 100%;
    height:100%;
    transition: 1s;
  }

  .ennemy {
    width: 80px;
    position: absolute;
    z-index: 2;
  }
</style>
<body>
  <div class='content'>
    <img class='overlay' alt="revolver" src="./img/bond.png"/>
    <img class='blood' alt="blood" src="./img/blood.png"/>
    <img class='metal' alt="metal" src="./img/metal.jpg"/>
    <img class='ennemy' alt="ennemy" src="./img/characters/1.jpg"/>
    <div class="end-game">
      <h1>Echec de la mission...</h1>
      <h2>Score: 0</h2>
      <a href="" class="btn btn-default">Recommencer</a>
    </div>
    <div class="win-game">
      <h1>Mission reussie !</h1>
      <a href="" class="btn btn-default">Recommencer</a>
    </div>
  </div>
</body>
</html>
<script src='../assets/js/jquery-3.2.1.min.js' type='text/javascript'></script>
<script src='../assets/js/bootstrap.min.js' type='text/javascript'></script>
<script type='text/javascript'>
  let focused = false
  let hitten = false
  let score = 0
  const screenWidth = window.innerWidth
  const screenHeight = window.innerHeight
  const content = document.querySelector('.content')
  const overlay = document.querySelector('.overlay')
  const blood = document.querySelector('.blood')
  const metal = document.querySelector('.metal')
  const ennemy = document.querySelector('.ennemy')
  const endGame = document.querySelector('.end-game')
  const winGame = document.querySelector('.win-game')

  const width = window.innerWidth
  const height = window.innerHeight
  content.style.width = width + 'px'
  content.style.height = height + 'px'

  function move (evt) {
    overlay.style.left = (evt.clientX - 375) + 'px'
    overlay.style.top = (evt.clientY - 310) + 'px'
    checkEnnemy(evt);
  }

  function lose() {
    document.removeEventListener('mousemove', move)
    document.body.style.cursor = 'default'
    clearInterval(moveInterval)
    const src = ennemy.src.split('/')
    console.log(src)
    switch(src[src.length-1]) {
      case "1.jpg":
        ennemy.src = "./img/characters/4.jpg"
        break
      case "2.jpg":
        ennemy.src = "./img/characters/5.jpg"
        break
      case "3.jpg":
        ennemy.src = "./img/characters/6.jpg"
        break
    }
    setTimeout(() => {
      endGame.style.display = "inline"
    }, 3000)
    blood.style.top = "0"
    focused = false
  }

  function win() {
    document.removeEventListener('mousemove', move)
    document.body.style.cursor = 'default'
    clearInterval(moveInterval)
    setTimeout(() => {
      winGame.style.display = "inline"
    }, 1000)
    metal.style.top = "0"
    focused = false
  }

  function checkEnnemy(evt) {
    if (evt.clientX > (ennemy.offsetLeft - 10) && evt.clientX < (ennemy.offsetLeft + 90) &&
    evt.clientY > (ennemy.offsetTop - 10) && evt.clientY < (ennemy.offsetTop + 200) && !focused && !hitten) {
      focused = true
      clearInterval(moveInterval)
      setTimeout(() => {
        if (focused) {
          lose()
        }
      },500)
    }
  }

  function getRandom(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min +1)) + min;
  }

  function moveEnnemy() {
    hitten = false
    ennemy.style.top = getRandom(0, innerHeight - 190) + 'px'
    ennemy.style.left = getRandom(0, innerWidth - 80) + 'px'
    const url = ennemy.src.split('.jpg')[0]
    ennemy.src = url.substr(0, url.length-1) + getRandom(1, 3) + '.jpg'

  }

  function hit(evt) {
    if (evt.clientX > ennemy.offsetLeft && evt.clientX < (ennemy.offsetLeft + 80) &&
    evt.clientY > ennemy.offsetTop && evt.clientY < (ennemy.offsetTop + 190) && !hitten) {
      focused = false
      hitten = true
      const src = ennemy.src
      ennemy.src = src.split('.jpg')[0] + '_hit.jpg'
      setTimeout(() => {
        ennemy.src = src
        score++
        if (score >= 10) {
          win()
        } else {
          moveEnnemy()
          moveInterval = setInterval(() => {
            moveEnnemy()
          }, 1500)
          document.querySelector('h2').innerHTML = 'Score: ' + score
        }
      }, 200)
    }
  }

  document.addEventListener('mousemove', move)
  document.addEventListener('click', hit)
  let moveInterval = setInterval(() => {
    moveEnnemy()
    console.log('okok')
  }, 1500)
</script>
